# ------------------------------------------------
# Deploy to Development Environment
# ------------------------------------------------
deploy-dev:
  name: Deploy to Dev
  runs-on: ubuntu-latest
  environment: dev # Links to the 'dev' GitHub environment for secrets and protection rules
  steps:
    - name: Checkout Code
      uses: actions/checkout@v4

    - name: Configure Azure Credentials
      uses: azure/login@v1
      with:
        client-id: ${{ secrets.AZURE_CLIENT_ID }}
        tenant-id: ${{ secrets.AZURE_TENANT_ID }}
        subscription-id: ${{ secrets.AZURE_SUBSCRIPTION_ID_DEV }} # Use dev-specific subscription ID

    - name: Terraform Init and Apply (Dev)
      run: |
      # Navigate to the dev environment directory
      cd environments/dev
      terraform init -backend-config="storage_account_name=${{ secrets.TFSTATE_STORAGE_ACCOUNT_DEV }}" -backend-config="container_name=tfstate" -backend-config="key=dev.terraform.tfstate"
      terraform apply -auto-approve
